<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V4: Tedarik Zinciri Felaketi SimÃ¼lasyonu</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/dracula.min.css">
    <style>
        :root {
            --dark-bg: #1a1a2e;
            --container-bg: #2a2a4a;
            --section-bg: #333355;
            --interactive-bg: #444466;
            --accent-blue: #8be9fd;
            --accent-purple: #bd93f9;
            --accent-pink: #ff79c6;
            --accent-green: #50fa7b;
            --accent-yellow: #f1fa8c;
            --accent-red: #ff5555;
            --text-light: #e0e0e0;
            --text-dark: #282a36;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        body { font-family: 'Roboto', sans-serif; background-color: var(--dark-bg); color: var(--text-light); margin: 0; padding: 20px; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; }
        .container { background-color: var(--container-bg); border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); padding: 20px; max-width: 950px; width: 100%; margin: 40px 0; }
        @media (min-width: 768px) { .container { padding: 40px; } }
        .centered-page { display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; min-height: 60vh; animation: fadeIn 0.5s ease-out; }
        h1 { font-size: 2.5em; color: var(--accent-blue); margin-bottom: 20px; }
        h2 { font-size: 2em; color: var(--accent-blue); border-bottom: 2px solid var(--interactive-bg); padding-bottom: 15px; margin-bottom: 25px; }
        h3 { font-size: 1.5em; color: var(--accent-blue); }
        h4 { font-size: 1.2em; color: var(--accent-purple); text-align: left; margin-top: 0; border-bottom: 1px solid var(--interactive-bg); padding-bottom: 10px; }
        p { line-height: 1.7; font-size: 1.1em; }
        .section { display: none; padding: 20px; background-color: var(--section-bg); border-radius: 8px; margin-top: 25px; animation: fadeIn 0.5s ease-out; }
        @media (min-width: 768px) { .section { padding: 30px; } }
        .interactive-element { background-color: var(--interactive-bg); border-radius: 8px; padding: 20px; margin-top: 20px; }
        .decision-buttons { display: flex; flex-direction: column; gap: 15px; margin-top: 30px; }
        .btn { background-color: #6272a4; color: white; border: none; padding: 15px 25px; border-radius: 8px; cursor: pointer; font-size: 1.1em; transition: all 0.3s ease; text-align: left; display: flex; align-items: center; gap: 15px; font-weight: 700; }
        .btn:hover { background-color: #7a8ab9; transform: translateY(-3px); box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .btn:disabled { background-color: #555 !important; color: #999 !important; cursor: not-allowed; transform: none; box-shadow: none; opacity: 0.7; }
        .btn .btn-text { flex-grow: 1; }
        .btn small { display: block; font-size: 0.85em; opacity: 0.8; margin-top: 5px; font-weight: 400; }
        .btn-start, .btn-continue { font-size: 1.3em; font-weight: bold; text-align: center; background-color: var(--accent-green); color: var(--text-dark); justify-content: center; }
        #intermissionSection .metric-change { font-size: 1.2em; margin: 15px 0; display: flex; align-items: center; gap: 10px; }
        .metric-change .positive { color: var(--accent-green); }
        .metric-change .negative { color: var(--accent-red); }
        #statusBar { display: flex; justify-content: space-around; flex-wrap: wrap; gap: 15px; background-color: var(--text-dark); padding: 15px; border-radius: 8px; margin-bottom: 25px; border: 1px solid #6272a4; }
        #statusBar .metric { text-align: center; font-size: 0.9em; }
        #statusBar .metric .value { font-size: 1.3em; font-weight: bold; color: var(--accent-yellow); }
        .final-metrics { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; margin-top: 20px; width: 100%; max-width: 850px; }
        .metric-card { background-color: var(--section-bg); padding: 25px; border-radius: 8px; text-align: center; border: 1px solid var(--interactive-bg); transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0,0,0,0.2); display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 150px; }
        .metric-card:hover { transform: scale(1.05); border-color: var(--accent-blue); }
        .metric-card .icon { font-size: 2.5em; color: var(--accent-blue); margin-bottom: 10px; }
        .metric-card .label { font-size: 1.1em; margin-bottom: 5px; color: var(--text-light); }
        .metric-card .value { font-size: 1.8em; font-weight: bold; color: var(--accent-yellow); }
        .code-block, .slack-chat { background-color: var(--text-dark); border: 1px solid #6272a4; border-radius: 8px; padding: 20px; margin-top: 15px; white-space: pre-wrap; word-break: break-all; font-family: 'Consolas', monospace; }
        .learning-note { background-color: var(--text-dark); border-left: 5px solid var(--accent-blue); padding: 20px; border-radius: 8px; margin-top: 30px; }
        .scenario-image { width: 100%; max-width: 500px; margin: 25px auto; display: block; border-radius: 8px; border: 1px solid var(--interactive-bg); box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .slack-chat .message { margin-bottom: 10px; padding: 8px; border-radius: 5px; background-color: #3f3f5a; }
        .slack-chat .sender { font-weight: bold; color: var(--accent-pink); }
        .slack-chat .sender.cso { color: var(--accent-green); }
        .slack-chat .sender.ops { color: var(--accent-yellow); }
        .slack-chat .sender.legal { color: var(--accent-blue); }
        .slack-chat .sender.ceo { color: var(--accent-purple); }
        .suspect-card { background-color: var(--interactive-bg); border-radius: 8px; padding: 15px; margin-bottom: 10px; border-left: 5px solid var(--accent-purple); box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
        .suspect-card h4 { margin-top: 0; margin-bottom: 5px; border-bottom: none; color: var(--accent-purple); }

        #finalSection { text-align: center; }
        #performance-badge-container { margin: 25px 0; }
        #performance-badge { padding: 12px 30px; font-size: 1.8em; font-weight: bold; border-radius: 50px; display: inline-block; color: var(--text-dark); box-shadow: 0 5px 20px rgba(0,0,0,0.4); transition: transform 0.3s ease; }
        #performance-badge:hover { transform: scale(1.05); }
        .post-crisis-layout { display: grid; grid-template-columns: 1fr; gap: 30px; text-align: left; margin-top: 40px; width: 100%; }
        @media (min-width: 800px) { .post-crisis-layout { grid-template-columns: 1fr 1fr; } }
        .event-timeline, .strategic-debrief { background-color: var(--interactive-bg); padding: 25px; border-radius: 8px; border: 1px solid var(--section-bg); margin-top: 20px; }
        .event-timeline h3, .strategic-debrief h3 { margin-top: 0; padding-bottom: 10px; border-bottom: 1px solid var(--section-bg); color: var(--accent-blue); display: flex; align-items: center; gap: 10px; }
        .event-timeline ul { list-style-type: none; padding-left: 0; margin: 15px 0 0 0; }
        .event-timeline li { position: relative; padding: 5px 0 15px 35px; border-left: 2px solid var(--section-bg); font-size: 0.95em; }
        .event-timeline li:last-child { border-left: none; }
        .event-timeline li::before { content: '\f00c'; font-family: 'Font Awesome 6 Free'; font-weight: 900; color: var(--accent-green); position: absolute; left: -12px; top: 5px; background-color: var(--dark-bg); width: 22px; height: 22px; border-radius: 50%; text-align: center; line-height: 22px; font-size: 0.8em; border: 2px solid var(--section-bg); }
        .event-timeline li.negative::before { content: '\f00d'; color: var(--accent-red); }
        .event-timeline li.neutral::before { content: '\f05a'; color: var(--accent-blue); }
        .event-timeline li .decision-title { font-weight: bold; color: var(--accent-purple); display: block; margin-bottom: 4px; }
        .event-timeline li .decision-impact { font-style: italic; opacity: 0.8; font-size: 0.9em; }
        #strategic-debrief-content p { font-size: 1em; margin-bottom: 15px; }

        #rolesInfo { background-color: var(--section-bg); border-radius: 8px; padding: 20px; margin-top: 30px; text-align: left; width: 100%; max-width: 600px; }
        #rolesInfo h3 { color: var(--accent-green); margin-top: 0; margin-bottom: 15px; border-bottom: 1px solid var(--interactive-bg); padding-bottom: 10px; display: flex; align-items: center; gap: 10px; }
        #rolesInfo ul { list-style-type: none; padding-left: 0; margin: 0; }
        #rolesInfo ul li { margin-bottom: 10px; padding-left: 25px; position: relative; }
        #rolesInfo ul li:last-child { margin-bottom: 0; }
        #rolesInfo ul li::before { content: '\f007'; font-family: 'Font Awesome 6 Free'; font-weight: 900; color: var(--accent-purple); position: absolute; left: 0; top: 3px; }
        #rolesInfo ul li.your-role::before { color: var(--accent-yellow); }
        #rolesInfo ul li strong { color: var(--accent-blue); }

        #score-breakdown { list-style: none; padding: 0; margin-top: 15px; text-align: left; }
        #score-breakdown li { padding: 8px 12px; border-radius: 6px; margin-bottom: 8px; font-size: 1.05em; display: flex; justify-content: space-between; }
        #score-breakdown .score-plus { background-color: rgba(80, 250, 123, 0.1); border-left: 3px solid var(--accent-green); }
        #score-breakdown .score-minus { background-color: rgba(255, 85, 85, 0.1); border-left: 3px solid var(--accent-red); }
        #score-breakdown .score-neutral { background-color: rgba(139, 233, 253, 0.1); border-left: 3px solid var(--accent-blue); }
        #score-breakdown .score-value { font-weight: bold; }
        .lb-overlay{ display:none; position:fixed; inset:0; background: rgba(10,10,25,.7); -webkit-backdrop-filter: blur(4px); backdrop-filter: blur(4px); z-index:9999; align-items:center; justify-content:center; padding:20px; animation: fadeIn 0.3s ease-out; }
        .lb-modal{ background: linear-gradient(180deg, #2a2a4a 0%, #1f1f36 100%); color: var(--text-light); width:100%; max-width: 760px; border-radius:14px; padding:22px 22px 16px; border:1px solid rgba(255,255,255,.08); box-shadow: 0 18px 50px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.04); }
        .lb-header{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px; }
        .lb-title{ display:flex; align-items:center; gap:10px; font-size:1.25em; font-weight:800; letter-spacing:.2px; color: var(--accent-yellow); }
        .lb-title i{ filter: drop-shadow(0 2px 6px rgba(0,0,0,.35)); }
        .lb-tablewrap{ margin-top:10px; max-height: 60vh; overflow:auto; border:1px solid var(--interactive-bg); border-radius:10px; box-shadow: inset 0 0 0 1px rgba(255,255,255,.02); }
        table.lb-table{ width:100%; border-collapse:collapse; font-size:.97em; }
        table.lb-table th, table.lb-table td{ padding:10px 12px; text-align:left; }
        table.lb-table thead th{ position: sticky; top:0; z-index:1; background:#1f1f36; color:#e9e9ff; border-bottom: 1px solid #3b3b66; font-weight:700; letter-spacing:.3px; }
        table.lb-table tbody td{ border-bottom:1px solid rgba(255,255,255,.06); color:#e9e9f5; }
        table.lb-table tbody tr:hover{ background-color: rgba(255,255,255,.045); }
        table.lb-table tbody tr:nth-child(1){ background: linear-gradient(90deg, rgba(255,215,0,.18), transparent 65%); }
        table.lb-table tbody tr:nth-child(1) td:first-child::after{ content:" ðŸ¥‡"; }
        table.lb-table tbody tr:nth-child(2){ background: linear-gradient(90deg, rgba(192,192,192,.18), transparent 65%); }
        table.lb-table tbody tr:nth-child(2) td:first-child::after{ content:" ðŸ¥ˆ"; }
        table.lb-table tbody tr:nth-child(3){ background: linear-gradient(90deg, rgba(205,127,50,.18), transparent 65%); }
        table.lb-table tbody tr:nth-child(3) td:first-child::after{ content:" ðŸ¥‰"; }
        .lb-actions{ display:flex; gap:12px; justify-content:flex-end; margin-top:14px; }
        .lb-close, .lb-refresh{ border:0; border-radius:10px; padding:10px 14px; cursor:pointer; font-weight:700; transition: transform .12s ease, box-shadow .12s ease, opacity .12s ease; }
        .lb-refresh{ background: var(--accent-blue); color:#0c1130; }
        .lb-close{ background: #3d3d60; color:#fff; }
        .lb-refresh:hover{ transform: translateY(-1px); box-shadow: 0 8px 18px rgba(139,233,253,.22); }
        .lb-close:hover{ transform: translateY(-1px); box-shadow: 0 8px 18px rgba(0,0,0,.35); }
        @media (max-width: 420px){ .lb-title{ font-size:1.05em; } table.lb-table th, table.lb-table td{ padding:9px 10px; } }
    </style>
</head>
<body>
    <div class="container">
        <div id="introSection" class="centered-page">
            <h1><i class="fa-solid fa-user-secret"></i> Tedarik Zinciri SaldÄ±rÄ± SimÃ¼lasyonu</h1>
            <p style="max-width: 600px;">HoÅŸ geldiniz, Siber Tehdit Ä°stihbaratÄ± (CTI) UzmanÄ±! BugÃ¼n ÅŸirketiniz **Ã‡OLHAK Teknoloji**'yi saran, kÃ¼resel bir tedarik zinciri felaketiyle yÃ¼zleÅŸeceksiniz. Gizli kapÄ±lar, sÄ±zan veriler ve sarsÄ±lan mÃ¼ÅŸteri gÃ¼veni... Bu simÃ¼lasyonda, sadece teknik sorunlarÄ± Ã§Ã¶zmekle kalmayacak, aynÄ± zamanda stratejik istihbaratÄ±n gÃ¼cÃ¼nÃ¼ kullanarak karmaÅŸÄ±k bir siber savaÅŸÄ± yÃ¶netecek ve ÅŸirketin kaderini belirleyeceksiniz. HazÄ±r mÄ±sÄ±nÄ±z?</p>
            <img src="images/intro_cyber.png" alt="Siber gÃ¼venlik temalÄ± bir giriÅŸ gÃ¶rseli" class="scenario-image">

            <div id="rolesInfo">
                <h3><i class="fa-solid fa-people-arrows"></i> SimÃ¼lasyon Rolleri</h3>
                <ul>
                    <li class="your-role"><strong>Sizin RolÃ¼nÃ¼z: CTI UzmanÄ±</strong> - Siber tehdit istihbaratÄ±nÄ± toplamak, analiz etmek, yorumlamak ve kriz ekibine rehberlik etmekle sorumlusunuz. SeÃ§imleriniz sonucu doÄŸrudan etkileyecektir.</li>
                    <li><strong>CEO Elara YÄ±lmaz</strong> - Åžirketin en Ã¼st dÃ¼zey yÃ¶neticisi, genel iÅŸ sÃ¼rekliliÄŸi ve kamuoyu algÄ±sÄ±na odaklanmÄ±ÅŸ durumda.</li>
                    <li><strong>CSO Can Demir</strong> - Siber gÃ¼venlik operasyonlarÄ±ndan ve savunma stratejilerinden sorumlu.</li>
                    <li><strong>Hukuk MÃ¼ÅŸaviri Zeynep Kaya</strong> - Hukuki uyumluluÄŸu denetler ve yasal riskleri azaltmak iÃ§in kamuoyu aÃ§Ä±klamalarÄ± konusunda danÄ±ÅŸmanlÄ±k yapar.</li>
                    <li><strong>Operasyon DirektÃ¶rÃ¼ Levent AkÄ±n</strong> - MÃ¼ÅŸteri hizmetleri ve iÅŸ sÃ¼rekliliÄŸi konusunda endiÅŸeli.</li>
                    <li><strong>TedarikÃ§i Ä°liÅŸkileri YÃ¶neticisi Dr. Aylin GÃ¼neÅŸ</strong> - TedarikÃ§ilerle iliÅŸkileri yÃ¶netiyor ve onlarÄ±n gÃ¼venilirliÄŸini deÄŸerlendiriyor.</li>
                </ul>
            </div>

            <button class="btn btn-start" id="startButton"><i class="fa-solid fa-play"></i> SimÃ¼lasyonu BaÅŸlat</button>
        </div>

        <div id="intermissionSection" class="centered-page" style="display: none;">
            <h2 id="intermissionTitle"></h2>
            <p id="intermissionText" style="max-width: 600px;"></p>
            <div class="interactive-element" style="width: 100%; max-width: 500px;">
                <h4>Karar Etkileri</h4>
                <div id="intermissionMetrics"></div>
            </div>
            <div class="interactive-element" style="width: 100%; max-width: 500px; border-left-color: var(--accent-blue); margin-top: 20px;">
                <h4>Stratejik DeÄŸerlendirme</h4>
                <p id="strategicText" style="font-size: 1em;"></p>
            </div>
            <button class="btn btn-continue" id="continueButton" style="margin-top: 30px;"><i class="fa-solid fa-forward"></i> Devam Et</button>
        </div>

        <div id="gameContainer" style="display: none;">
            <div id="statusBar">
                <div class="metric"><span><i class="fa-solid fa-triangle-exclamation"></i> Etkilenen Sistem</span><div class="value" id="status-affectedSystems">0</div></div>
                <div class="metric"><span><i class="fa-solid fa-hand-holding-dollar"></i> Finansal Zarar</span><div class="value" id="status-financialLoss">â‚º0</div></div>
                <div class="metric"><span><i class="fa-solid fa-database"></i> Veri SÄ±zÄ±ntÄ±sÄ±</span><div class="value" id="status-dataLeak">0%</div></div>
                <div class="metric"><span><i class="fa-solid fa-building-shield"></i> Ä°tibar PuanÄ±</span><div class="value" id="status-reputation">100</div></div>
                <div class="metric"><span><i class="fa-solid fa-clock"></i> Kalan SÃ¼re</span><div class="value" id="status-timer">05:00</div></div>
            </div>
            <div id="game-content">
            </div>
        </div>
    </div>
    
    <div class="lb-overlay" id="leaderboardOverlay" role="dialog" aria-modal="true" aria-labelledby="lbTitle">
        <div class="lb-modal">
            <div class="lb-header">
                <h2 id="lbTitle" class="lb-title"><i class="fa-solid fa-trophy"></i> Liderlik Tablosu</h2>
                <span class="lb-sub">Tedarik Zinciri SimÃ¼lasyonu En Ä°yileri</span>
            </div>
            <div class="lb-tablewrap">
                <table class="lb-table" id="leaderboardTable">
                    <thead>
                        <tr><th>#</th><th>Ä°sim</th><th>Puan</th><th>Tarih</th></tr>
                    </thead>
                    <tbody id="leaderboardBody">
                        <tr><td colspan="4">YÃ¼kleniyorâ€¦</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="lb-actions">
                <button class="lb-refresh" id="lbRefreshBtn"><i class="fa-solid fa-arrows-rotate"></i> Yenile</button>
                <button class="lb-close" id="lbCloseBtn">Kapat</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            window.game = {
                score: { affectedSystems: 0, financialLoss: 0, dataLeak: 0, reputation: 100 },
                state: {
                    currentSectionId: 'start',
                    synapseTechInfoGathered: false,
                    blackTyphoonTTPsAnalyzed: false,
                    legalReviewInitiated: false,
                    techScanInitiated: false,
                    supplierContacted: false,
                    malwareAnalysisComplete: false,
                    criticalModulesIsolated: false,
                    motivationAnalyzed: false,
                    synapseTechVulnerabilityAnalyzed: false, 
                    officialReportMade: false, 
                    pressConferenceHeld: false, 
                    decisionHistory: []
                },
                elements: {},
                timer: {
                    total: 300,
                    remaining: 300,
                    intervalId: null,
                    running: false
                },
                
                decisionInfo: {
                    'g1-s-bilgilendir-ust-yonetim': { 
                        title: "HÄ±zlÄ± Ãœst YÃ¶netim Bilgilendirmesi", 
                        text: "HenÃ¼z kesin kanÄ±t olmasa da, potansiyel tehdidi CEO ve CSO'ya ilettiniz. Bu, kriz ekibini erkenden harekete geÃ§irdi ancak bazÄ± soru iÅŸaretleri yarattÄ±.", 
                        strat: "Kritik gÃ¼venlik olaylarÄ±nda Ã¼st yÃ¶netimi hÄ±zla bilgilendirmek, proaktif kriz yÃ¶netimi iÃ§in esastÄ±r ancak bilgi doÄŸruluÄŸu kritik Ã¶neme sahiptir.", 
                        changes: { financialLoss: 10000, reputation: -2 }, 
                        impact: 'Neutral' 
                    },
                    'g1-s-istihbarat-dogrula': { 
                        title: "Derinlemesine Ä°stihbarat DoÄŸrulama", 
                        text: "Dark web fÄ±sÄ±ltÄ±sÄ±nÄ±n gÃ¼venilirliÄŸini teyit etmek iÃ§in kapsamlÄ± araÅŸtÄ±rma baÅŸlattÄ±nÄ±z. Bu, deÄŸerli bilgiler saÄŸladÄ± ancak zaman kaybÄ±na neden olma riski taÅŸÄ±dÄ±.", 
                        strat: "Ä°stihbaratÄ±n doÄŸruluÄŸu hayati Ã¶neme sahiptir. Ancak kriz anÄ±nda hÄ±z ile doÄŸruluk arasÄ±nda doÄŸru dengeyi bulmak, en zor kararlardan biridir.", 
                        changes: { financialLoss: 5000, reputation: -1 }, 
                        clue: 'synapseTechInfoGathered', 
                        impact: 'Positive' 
                    },
                    'g1-o-teknik-tarama': {
                        title: "Acil Teknik Tarama BaÅŸlatÄ±ldÄ±",
                        text: "CSO Can Demir'in ekibine TAL raporundaki IOC/TTP'leri ilettiniz ve acil tarama talimatÄ± verdiniz. Bu, olasÄ± zafiyetleri hÄ±zla tespit etmeyi hedefledi.",
                        strat: "Erken ve teknik odaklÄ± mÃ¼dahale, hasarÄ± sÄ±nÄ±rlamak iÃ§in hayati Ã¶neme sahiptir. DoÄŸru IOC'lerle yapÄ±lan taramalar, saldÄ±rÄ±nÄ±n kapsamÄ±nÄ± hÄ±zla ortaya Ã§Ä±karabilir.",
                        changes: { financialLoss: 30000, reputation: -3, affectedSystems: 5 }, 
                        clue: 'techScanInitiated',
                        impact: 'Positive'
                    },
                    'g1-o-tedarikci-iletisim': {
                        title: "Smart Teknoloji ile Ä°letiÅŸim Kuruldu",
                        text: "TedarikÃ§i Ä°liÅŸkileri YÃ¶neticisi Dr. Aylin GÃ¼neÅŸ aracÄ±lÄ±ÄŸÄ±yla Smart Teknoloji ile temasa geÃ§ildi. Ortak soruÅŸturma talebiniz, tedarikÃ§ide bazÄ± rahatsÄ±zlÄ±klara neden oldu.",
                        strat: "TedarikÃ§i iÅŸ birliÄŸi, tedarik zinciri saldÄ±rÄ±larÄ±nda kritik Ã¶neme sahiptir. Ancak iliÅŸkilerin yÃ¶netimi ve bilgi paylaÅŸÄ±mÄ±nÄ±n hassasiyeti dikkatli bir yaklaÅŸÄ±m gerektirir.",
                        changes: { financialLoss: 15000, reputation: -7 }, 
                        clue: 'supplierContacted',
                        impact: 'Neutral'
                    },
                    'g1-o-hukuki-degerlendirme': {
                        title: "Hukuki DeÄŸerlendirme ve Ä°letiÅŸim PlanÄ±",
                        text: "Hukuk MÃ¼ÅŸaviri Zeynep Kaya ile yasal yÃ¼kÃ¼mlÃ¼lÃ¼kler ve kriz iletiÅŸim stratejisi Ã¼zerine Ã§alÄ±ÅŸtÄ±nÄ±z. Bu, kamuoyuyla iletiÅŸimde saÄŸlam bir temel oluÅŸturdu ancak teknik mÃ¼dahaleyi geciktirme riski taÅŸÄ±dÄ±.",
                        strat: "Kriz iletiÅŸimi ve yasal uyumluluk Ã¶nemlidir, ancak teknik soruÅŸturma ve mÃ¼dahale tamamlanmadan aceleci davranmak, durumu daha da karmaÅŸÄ±k hale getirebilir.",
                        changes: { financialLoss: 25000, dataLeak: 2 }, 
                        clue: 'legalReviewInitiated',
                        impact: 'Neutral'
                    },
                    'g2-s-tersine-muhendislik': {
                        title: "KÃ¶tÃ¼ AmaÃ§lÄ± YazÄ±lÄ±m Tersine MÃ¼hendisliÄŸi",
                        text: "KÃ¶tÃ¼ amaÃ§lÄ± yazÄ±lÄ±mÄ±n yeteneklerini anlamak iÃ§in tersine mÃ¼hendislik ekibini acilen gÃ¶revlendirdiniz. Bu, saldÄ±rganÄ±n tam kapasitesini ortaya Ã§Ä±kardÄ± ancak analiz sÃ¼resince hasar devam etti.",
                        strat: "SaldÄ±rÄ±nÄ±n derinlemesine anlaÅŸÄ±lmasÄ±, uzun vadeli savunma iÃ§in hayati Ã¶nem taÅŸÄ±r. Ancak hÄ±zlÄ± aksiyon ile kapsamlÄ± analiz arasÄ±nda denge kurmak, krizi yÃ¶netmek iÃ§in esastÄ±r.",
                        changes: { financialLoss: 50000, dataLeak: 5, reputation: -10 }, 
                        clue: 'malwareAnalysisComplete',
                        impact: 'Negative'
                    },
                    'g2-s-modul-yalÄ±tma': {
                        title: "Kritik ModÃ¼llerin Acil YalÄ±tÄ±lmasÄ±",
                        text: "Etkilenen tÃ¼m mÃ¼ÅŸterilerin Temel yazÄ±lÄ±m altyapÄ±larÄ±nÄ± acilen devre dÄ±ÅŸÄ± bÄ±rakmayÄ± veya yalÄ±tmayÄ± Ã¶nerdiniz. Bu, saldÄ±rganÄ±n yayÄ±lmasÄ±nÄ± durdurdu ancak mÃ¼ÅŸterilerin operasyonlarÄ±nda bÃ¼yÃ¼k aksaklÄ±klara yol aÃ§tÄ±.",
                        strat: "HÄ±zlÄ± ve radikal kararlar, anlÄ±k hasarÄ± durdurabilir ancak uzun vadede bÃ¼yÃ¼k operasyonel ve finansal sonuÃ§larÄ± olabilir.",
                        changes: { financialLoss: 250000, affectedSystems: 20, reputation: -25 }, 
                        clue: 'criticalModulesIsolated',
                        impact: 'Negative'
                    },
                    'g2-s-motivasyon-analizi': {
                        title: "Kara Tayfun Motivasyon Analizi",
                        text: "Kara Tayfun grubunun motivasyonlarÄ±nÄ± ve hedeflerini analiz ederek kriz ekibine stratejik bir brifing verdiniz. Bu, olayÄ±n daha geniÅŸ baÄŸlamÄ±nÄ± anlamayÄ± saÄŸladÄ± ancak teknik mÃ¼dahaleyi geciktirdi.",
                        strat: "Tehdit aktÃ¶rÃ¼nÃ¼n niyetini anlamak, uzun vadeli savunma ve karÅŸÄ± tedbirler iÃ§in hayati Ã¶neme sahiptir. Ancak anlÄ±k krizde, teknik mÃ¼dahalenin hÄ±zÄ± Ã§oÄŸu zaman daha belirleyicidir.",
                        changes: { financialLoss: 75000, dataLeak: 10, reputation: -15 }, 
                        clue: 'motivationAnalyzed',
                        impact: 'Negative'
                    },
                    'g2-o-synapsetech-arastirma': { 
                        title: "SynapseTech Zafiyet Analizi",
                        text: "SynapseTech kÃ¼tÃ¼phanesindeki zafiyeti derinlemesine incelediniz ve kÃ¶tÃ¼ye kullanÄ±m biÃ§imlerini belgelediniz. Bu, saldÄ±rÄ±nÄ±n kÃ¶k nedenini tam olarak anlamanÄ±zÄ± ve gelecekte benzer saldÄ±rÄ±larÄ± Ã¶nlemek iÃ§in stratejik bilgiler saÄŸlamanÄ±zÄ± saÄŸladÄ±.",
                        strat: "KÃ¶k neden analizi, bir saldÄ±rÄ±nÄ±n sadece semptomlarÄ±nÄ± deÄŸil, altÄ±nda yatan gÃ¼venlik zafiyetlerini de ortadan kaldÄ±rmak iÃ§in kritik Ã¶neme sahiptir.",
                        changes: { financialLoss: 100000, reputation: +10, dataLeak: -5 }, 
                        clue: 'synapseTechVulnerabilityAnalyzed', 
                        impact: 'Positive'
                    },
                    'g2-o-sucu-resmi-makamlara-bildir': {
                        title: "Resmi Makamlara Bildirim",
                        text: "SaldÄ±rÄ±yÄ± ulusal siber gÃ¼venlik birimlerine ve kolluk kuvvetlerine resmen bildirdiniz. Bu, yasal sÃ¼reci baÅŸlattÄ± ve kamuoyu nezdinde ÅŸirketinizin sorumluluk sahibi olduÄŸunu gÃ¶sterdi, ancak soruÅŸturma sÃ¼reÃ§leri iÅŸ yÃ¼kÃ¼nÃ¼ artÄ±rdÄ±.",
                        strat: "Siber suÃ§larÄ±n resmi makamlara bildirilmesi, yasal uyumluluk ve ulusal siber gÃ¼venliÄŸe katkÄ± aÃ§Ä±sÄ±ndan Ã¶nemlidir. Ancak, bu durum operasyonel ve hukuki ek yÃ¼k getirebilir.",
                        changes: { financialLoss: 50000, reputation: +5 }, 
                        clue: 'officialReportMade',
                        impact: 'Neutral'
                    },
                    'g2-o-daha-fazla-istihbarat': {
                        title: "Daha Fazla Tehdit Ä°stihbaratÄ± Topla",
                        text: "SaldÄ±rÄ±nÄ±n arkasÄ±ndaki grubun diÄŸer tedarik zinciri saldÄ±rÄ±larÄ±nÄ± araÅŸtÄ±rdÄ±nÄ±z ve olasÄ± gelecek hedeflerini anlamaya Ã§alÄ±ÅŸtÄ±nÄ±z. Bu, proaktif savunma iÃ§in deÄŸerli bilgiler saÄŸladÄ± ancak mevcut olay yerindeki mÃ¼dahaleyi biraz yavaÅŸlattÄ±.",
                        strat: "Tehdit istihbaratÄ±nÄ± sÃ¼rekli beslemek, sadece geÃ§miÅŸ saldÄ±rÄ±larÄ± anlamakla kalmaz, aynÄ± zamanda gelecekteki tehditleri Ã¶ngÃ¶rmek iÃ§in de kritik Ã¶neme sahiptir.",
                        changes: { financialLoss: 30000, reputation: -5, dataLeak: +3 }, 
                        clue: 'moreThreatIntelGathered',
                        impact: 'Neutral'
                    },
                    'g3-s-tam-seffaflÄ±k': { 
                        title: "Tam ÅžeffaflÄ±k PolitikasÄ±",
                        text: "SaldÄ±rÄ±nÄ±n detaylarÄ±nÄ±, Kara Tayfun grubunu ve tedarik zinciri zafiyetini kamuoyuna ve mÃ¼ÅŸterilere detaylÄ±ca aÃ§Ä±kladÄ±nÄ±z. Bu, baÅŸta ÅŸok yaratsa da, uzun vadede ÅŸirketinize olan gÃ¼veni artÄ±rdÄ±.",
                        strat: "Kriz iletiÅŸiminde tam ÅŸeffaflÄ±k, riskli olsa da, dÃ¼rÃ¼stlÃ¼k algÄ±sÄ± yaratarak uzun vadeli itibar kazanÄ±mÄ± saÄŸlayabilir ve sektÃ¶rde Ã¶rnek teÅŸkil edebilir.",
                        changes: { financialLoss: 200000, reputation: +20, dataLeak: -5 }, 
                        impact: 'Positive'
                    },
                    'g3-s-sÄ±nÄ±rlÄ±-acÄ±klama': {
                        title: "SÄ±nÄ±rlÄ± Kamuoyu AÃ§Ä±klamasÄ±",
                        text: "Sadece 'teknik bir problem' olduÄŸunu belirterek detaylardan kaÃ§Ä±ndÄ±nÄ±z. Bu, baÅŸlangÄ±Ã§ta paniÄŸi Ã¶nlese de, kamuoyunda ÅŸÃ¼phe uyandÄ±rdÄ± ve gÃ¼veni tam olarak saÄŸlayamadÄ±.",
                        strat: "SÄ±nÄ±rlÄ± bilgi paylaÅŸÄ±mÄ±, kÄ±sa vadede durumu idare etse de, uzun vadede ÅŸirketin ÅŸeffaflÄ±k algÄ±sÄ±nÄ± zedeleyebilir ve daha fazla spekÃ¼lasyona yol aÃ§abilir.",
                        changes: { financialLoss: 500000, reputation: -15, dataLeak: 10 }, 
                        impact: 'Negative'
                    },
                    'g3-s-sucu-disari-atma': { 
                        title: "SuÃ§u TedarikÃ§iye Atma",
                        text: "SorumluluÄŸu tamamen Smart Teknoloji'ye yÃ¼klediniz. Bu, ÅŸirket iÃ§i rahatlama saÄŸlasa da, tedarikÃ§i iliÅŸkilerini zedeledi ve kamuoyu nezdinde kÃ¶tÃ¼ bir izlenim bÄ±raktÄ±. Yasal sÃ¼reÃ§ler tetiklendi.",
                        strat: "SuÃ§u baÅŸkasÄ±na atmak, kÄ±sa vadede rahatlama saÄŸlasa da, uzun vadede ÅŸirketler arasÄ± iliÅŸkileri zehirler, yasal riskleri artÄ±rÄ±r ve kamuoyu nezdinde gÃ¼veni kÃ¶kten sarsar.",
                        changes: { financialLoss: 750000, reputation: -30, affectedSystems: 10 }, 
                        impact: 'Negative'
                    },
                    'g3-o-kapsamlÄ±-guvenlik-programÄ±': {
                        title: "KapsamlÄ± Tedarik Zinciri GÃ¼venliÄŸi ProgramÄ±",
                        text: "TÃ¼m tedarikÃ§iler iÃ§in zorunlu denetimler, SBOM, SCA ve TPRM entegrasyonu gibi kapsamlÄ± bir program Ã¶nerdiniz. CTI kaynaklarÄ±nÄ±n artÄ±rÄ±lmasÄ± talebiniz olumlu karÅŸÄ±landÄ±. Åžirket, siber dayanÄ±klÄ±lÄ±ÄŸÄ±nÄ± Ã¶nemli Ã¶lÃ§Ã¼de artÄ±rdÄ±.",
                        strat: "Kriz sonrasÄ± gÃ¼Ã§lÃ¼ bir gÃ¼venlik duruÅŸu oluÅŸturmak, gelecekteki saldÄ±rÄ±larÄ± Ã¶nlemenin ve itibar kazanmanÄ±n anahtarÄ±dÄ±r. Bu, Ã¶nemli kaynak ve yÃ¶netim desteÄŸi gerektirir ancak uzun vadede en iyi yatÄ±rÄ±m budur.",
                        changes: { financialLoss: 500000, reputation: +30, dataLeak: -15, affectedSystems: -10 }, 
                        impact: 'Positive'
                    },
                    'g3-o-odaklÄ±-iyilestirme': { 
                        title: "OdaklÄ± Ä°yileÅŸtirme ve Acil Ã–nlemler",
                        text: "Sadece temel yazÄ±lÄ±m altyapÄ±sÄ±ndaki zafiyetleri gidermeye odaklandÄ±nÄ±z. KÄ±sa vadeli Ã§Ã¶zÃ¼mler uygulandÄ± ancak diÄŸer potansiyel riskler gÃ¶z ardÄ± edildi. Åžirket, kÄ±sa vadede toparlansa da, gelecekte benzer saldÄ±rÄ±lara karÅŸÄ± hala savunmasÄ±z.",
                        strat: "OdaklÄ± iyileÅŸtirme, anlÄ±k sorunlarÄ± Ã§Ã¶zmek iÃ§in etkili olabilir ancak siber gÃ¼venliÄŸin sÃ¼rekli evrilen doÄŸasÄ±na karÅŸÄ± uzun vadeli bir Ã§Ã¶zÃ¼m sunmayabilir. Bu, gizli riskler yaratÄ±r.",
                        changes: { financialLoss: 100000, reputation: +5, dataLeak: +5, affectedSystems: +5 }, 
                        impact: 'Neutral'
                    },
                    'g3-o-degerlendirmeyi-geciktir': { 
                        title: "Kriz SonrasÄ± DeÄŸerlendirmeyi Geciktirme",
                        text: "Krizin yorgunluÄŸu ve maliyetler nedeniyle kapsamlÄ± deÄŸerlendirmeyi ve yatÄ±rÄ±mlarÄ± ertelediniz. Åžirket 'normale dÃ¶nmeye' odaklansa da, gelecekte benzer bir kriz riski arttÄ± ve itibar kaybÄ± devam etti.",
                        strat: "Krizlerden ders Ã§Ä±karmamak, bir ÅŸirketin siber gÃ¼venlik olgunluÄŸunu dÃ¼ÅŸÃ¼rÃ¼r ve gelecekteki risklere karÅŸÄ± savunmasÄ±z bÄ±rakÄ±r. Bu en kÃ¶tÃ¼ senaryolardan biridir.",
                        changes: { financialLoss: 1500000, reputation: -40, affectedSystems: 20, dataLeak: +15 }, 
                        impact: 'Negative'
                    }
                },

                setup() {
                    this.elements = {
                        intro: document.getElementById('introSection'), game: document.getElementById('gameContainer'), gameContent: document.getElementById('game-content'),
                        startButton: document.getElementById('startButton'), intermission: document.getElementById('intermissionSection'),
                        intermissionTitle: document.getElementById('intermissionTitle'), intermissionText: document.getElementById('intermissionText'),
                        intermissionMetrics: document.getElementById('intermissionMetrics'), strategicText: document.getElementById('strategicText'),
                        continueButton: document.getElementById('continueButton'),
                        statusBar: { 
                            affectedSystems: document.getElementById('status-affectedSystems'), 
                            financialLoss: document.getElementById('status-financialLoss'), 
                            dataLeak: document.getElementById('status-dataLeak'), 
                            reputation: document.getElementById('status-reputation'),
                            timer: document.getElementById('status-timer') ? document.getElementById('status-timer').querySelector('.value') : null
                        },
                        leaderboard: {
                            overlay: document.getElementById('leaderboardOverlay'),
                            body: document.getElementById('leaderboardBody'),
                            btnClose: document.getElementById('lbCloseBtn'),
                            btnRefresh: document.getElementById('lbRefreshBtn'),
                            btnOpen: null // Will be assigned later
                        }
                    };
                    this.loadGameHTML();
                    this.attachListeners();
                    this.elements.intro.style.display = 'flex';
                    this.elements.game.style.display = 'none';
                },

                attachListeners() {
                    this.elements.startButton.addEventListener('click', () => {
                        this.elements.intro.style.display = 'none';
                        this.elements.game.style.display = 'block';
                        this.startGlobalTimer();
                        this.showSection('day1_morning');
                    });
                    
                    this.elements.gameContent.addEventListener('click', (e) => {
                        const button = e.target.closest('.btn[data-decision]');
                        if (!button) return;
                        
                        const decisionId = button.dataset.decision;
                        const nextSection = button.dataset.nextSection;

                        this.handleDecision(decisionId, nextSection, button);
                    });

                    this.elements.continueButton.addEventListener('click', () => {
                        const nextSectionId = this.elements.continueButton.dataset.nextSection;
                        this.elements.intermission.style.display = 'none';
                        
                        if (nextSectionId === 'finalSection') {
                             this.showFinalReport();
                        } else {
                            this.elements.game.style.display = 'block';
                            this.showSection(nextSectionId);
                        }
                    });
                    
                    this.elements.leaderboard.btnClose?.addEventListener('click', () => this.closeLeaderboard());
                    this.elements.leaderboard.btnRefresh?.addEventListener('click', () => this.loadLeaderboard());
                    this.elements.leaderboard.overlay.addEventListener('click', (e) => {
                        if (e.target === this.elements.leaderboard.overlay) this.closeLeaderboard();
                    });
                },
                
                handleDecision(decisionId, nextSectionId, button) {
                    button.closest('.decision-buttons').querySelectorAll('.btn').forEach(btn => btn.disabled = true);
                    const info = this.decisionInfo[decisionId];
                    if (!info) { console.error("Karar bilgisi bulunamadÄ±:", decisionId); return; }

                    this.score.financialLoss += info.changes.financialLoss || 0;
                    this.score.reputation += info.changes.reputation || 0;
                    this.score.dataLeak += info.changes.dataLeak || 0;
                    this.score.affectedSystems += info.changes.affectedSystems || 0;
                    
                    if (info.clue) {
                        this.state[info.clue] = true;
                    }
                    
                    this.state.decisionHistory.push({ id: decisionId, title: info.title, text: info.text, impactType: info.impact }); 
                    this.updateState();
                    this.showIntermission(info.title, info.text, info.strat, info.changes, nextSectionId);
                },

                showIntermission(title, text, strat, changes, nextSectionId) {
                    this.elements.intermissionTitle.textContent = title;
                    this.elements.intermissionText.textContent = text;
                    this.elements.strategicText.textContent = strat;
                    
                    let metricsHTML = '';
                    const formatChange = (label, value, unit, icon, isPositive) => {
                        const arrow = value >= 0 ? 'up' : 'down';
                        const sign = value >= 0 ? '+' : ''; 
                        return `<div class="metric-change ${isPositive ? 'positive' : 'negative'}"><i class="fa-solid ${icon}"></i> ${label}: <i class="fa-solid fa-arrow-${arrow}-long"></i> ${sign}${Math.abs(value).toLocaleString('tr-TR')}${unit}</div>`;
                    };

                    if (changes.financialLoss) metricsHTML += formatChange('Finansal Zarar', changes.financialLoss, 'â‚º', 'fa-sack-xmark', false);
                    if (changes.dataLeak) metricsHTML += formatChange('Veri SÄ±zÄ±ntÄ±sÄ±', changes.dataLeak, '%', 'fa-database', false);
                    if (changes.reputation !== undefined) metricsHTML += formatChange('Ä°tibar PuanÄ±', changes.reputation, '', 'fa-building-shield', changes.reputation > 0);
                    if (changes.affectedSystems) metricsHTML += formatChange('Etkilenen Sistem', changes.affectedSystems, '', 'fa-triangle-exclamation', false);
                    
                    if (metricsHTML === '') metricsHTML = '<p style="text-align: center; font-size: 1.1em; opacity: 0.8;">Bu kararÄ±n metriklere doÄŸrudan bir etkisi olmadÄ±.</p>';

                    this.elements.intermissionMetrics.innerHTML = metricsHTML;
                    this.elements.continueButton.dataset.nextSection = nextSectionId;
                    this.elements.game.style.display = 'none';
                    this.elements.intermission.style.display = 'flex';
                },

                updateStatusBar() {
                    const s = this.score;
                    this.elements.statusBar.affectedSystems.textContent = s.affectedSystems;
                    this.elements.statusBar.financialLoss.textContent = `â‚º${s.financialLoss.toLocaleString('tr-TR')}`;
                    this.elements.statusBar.dataLeak.textContent = `${s.dataLeak}%`;
                    this.elements.statusBar.reputation.textContent = Math.max(0, s.reputation);
                },

                showSection(sectionId) {
                    this.elements.sections.forEach(section => { section.style.display = 'none'; });
                    const targetSection = document.getElementById(sectionId);
                    if (targetSection) {
                        targetSection.style.display = 'block';
                        this.state.currentSectionId = sectionId;
                        this.updateDynamicContent(sectionId);
                    } else {
                        console.error('BÃ¶lÃ¼m bulunamadÄ±:', sectionId);
                        this.showFinalReport();
                    }
                    this.updateState();
                },
                
                showFinalReport() {
                    this.stopGlobalTimer();
                    this.elements.intro.style.display = 'none';
                    this.elements.intermission.style.display = 'none';
                    this.elements.game.style.display = 'block'; 
                    document.getElementById('statusBar').style.display = 'none';

                    this.elements.sections.forEach(section => {
                        section.style.display = 'none';
                    });
                    
                    const finalSection = document.getElementById('finalSection');
                    if (!finalSection) { console.error("Final bÃ¶lÃ¼mÃ¼ HTML'de bulunamadÄ±!"); return; }

                    finalSection.style.display = 'flex';
                    finalSection.style.flexDirection = 'column';
                    finalSection.style.alignItems = 'center';
                    
                    const badge = document.getElementById('performance-badge');
                    const metricsContainer = document.getElementById('finalMetricsContainer');
                    const timelineList = document.getElementById('decision-timeline-list');
                    const debriefContent = document.getElementById('strategic-debrief-content');
                    const scoreBreakdownList = document.getElementById('score-breakdown');

                    // --- PUANLAMA SÄ°STEMÄ° ---
                    let scoreBreakdown = {};
                    let totalScore = 35; 
                    scoreBreakdown['BaÅŸlangÄ±Ã§ PuanÄ±'] = { value: 35, class: 'score-neutral' };

                    let decisionQualityScore = 0;
                    this.state.decisionHistory.forEach(decision => {
                        if (decision.impactType === 'Negative') {
                            decisionQualityScore -= 7;
                        } else if (decision.impactType === 'Positive') {
                            decisionQualityScore += 3;
                        }
                    });
                     if (decisionQualityScore !== 0) {
                        totalScore += decisionQualityScore;
                        scoreBreakdown['Karar Kalitesi (Ceza/Ã–dÃ¼l)'] = { value: decisionQualityScore, class: decisionQualityScore >= 0 ? 'score-plus' : 'score-minus' };
                    }
                    
                    const finalRep = Math.max(0, this.score.reputation);
                    let repScore = 0;
                    if (finalRep >= 90) { repScore = 20; }
                    else if (finalRep >= 70) { repScore = 10; }
                    else if (finalRep < 40) { repScore = -20; }
                    totalScore += repScore;
                    scoreBreakdown['Ä°tibar YÃ¶netimi'] = { value: repScore, class: repScore > 0 ? 'score-plus' : repScore < 0 ? 'score-minus' : 'score-neutral' };

                    let financialScore = 0;
                    if (this.score.financialLoss <= 500000) { financialScore = 15; }
                    else if (this.score.financialLoss <= 1000000) { financialScore = 5; }
                    else { financialScore = -20; }
                    totalScore += financialScore;
                    scoreBreakdown['Finansal YÃ¶netim'] = { value: financialScore, class: financialScore > 0 ? 'score-plus' : financialScore < 0 ? 'score-minus' : 'score-neutral' };

                    let dataLeakScore = 0;
                    if (this.score.dataLeak <= 5) { dataLeakScore = 15; }
                    else if (this.score.dataLeak <= 15) { dataLeakScore = 0; }
                    else { dataLeakScore = -20; }
                    totalScore += dataLeakScore;
                    scoreBreakdown['Veri SÄ±zÄ±ntÄ±sÄ± KontrolÃ¼'] = { value: dataLeakScore, class: dataLeakScore > 0 ? 'score-plus' : dataLeakScore < 0 ? 'score-minus' : 'score-neutral' };

                    if (this.timer.remaining >= 180) {
                        totalScore += 5;
                        scoreBreakdown['HÄ±zlÄ± MÃ¼dahale Bonusu'] = { value: 5, class: 'score-plus' };
                    }

                    totalScore = Math.round(Math.max(0, Math.min(100, totalScore))); 
                    // --- PUANLAMA SÄ°STEMÄ° SONU ---

                    let badgeInfo = {};
                    if (totalScore >= 90) badgeInfo = { text: 'SÄ°BER KAHRAMAN', color: 'var(--accent-green)' };
                    else if (totalScore >= 70) badgeInfo = { text: 'UZMAN STRATEJÄ°ST', color: 'var(--accent-blue)' };
                    else if (totalScore >= 40) badgeInfo = { text: 'KRÄ°ZÄ° YÃ–NETTÄ°', color: 'var(--accent-yellow)' };
                    else badgeInfo = { text: 'FELAKET', color: 'var(--accent-red)' };

                    badge.textContent = badgeInfo.text;
                    badge.style.backgroundColor = badgeInfo.color;

                    metricsContainer.innerHTML = `
                        <div class="metric-card"><div class="icon"><i class="fa-solid fa-file-invoice-dollar"></i></div><div class="label">Nihai Puan</div><div class="value">${totalScore}/100</div></div>
                        <div class="metric-card"><div class="icon"><i class="fa-solid fa-building-shield"></i></div><div class="label">Ä°tibar PuanÄ±</div><div class="value">${finalRep}/100</div></div>
                        <div class="metric-card"><div class="icon"><i class="fa-solid fa-hand-holding-dollar"></i></div><div class="label">Finansal Zarar</div><div class="value">â‚º${this.score.financialLoss.toLocaleString('tr-TR')}</div></div>
                        <div class="metric-card"><div class="icon"><i class="fa-solid fa-database"></i></div><div class="label">Veri SÄ±zÄ±ntÄ±sÄ±</div><div class="value">${this.score.dataLeak}%</div></div>
                        <div class="metric-card"><div class="icon"><i class="fa-solid fa-triangle-exclamation"></i></div><div class="label">Etkilenen Sistem</div><div class="value">${this.score.affectedSystems}</div></div>
                    `;

                    timelineList.innerHTML = this.state.decisionHistory.map(decision => {
                        let liClass = decision.impactType.toLowerCase();
                        return `<li class="${liClass}"><span class="decision-title">${decision.title}</span></li>`;
                    }).join('');
                    
                    scoreBreakdownList.innerHTML = Object.entries(scoreBreakdown).map(([key, item]) => {
                        const sign = item.value >= 0 ? '+' : '';
                        return `<li class="${item.class}"><span>${key}</span><span class="score-value">${sign}${item.value} Puan</span></li>`;
                    }).join('');

                    let debriefHTML = '';
                    if (badgeInfo.text === 'SÄ°BER KAHRAMAN' || badgeInfo.text === 'UZMAN STRATEJÄ°ST') { 
                        debriefHTML += `<p><strong>Kriz YÃ¶netiminde Liderlik:</strong> HÄ±zlÄ±, doÄŸru ve ÅŸeffaf kararlarÄ±nÄ±z sayesinde Ã‡OLHAK Teknoloji, bu kÃ¼resel tedarik zinciri krizinden minimum hasarla Ã§Ä±ktÄ±. CTI uzmanlÄ±ÄŸÄ±nÄ±z, saldÄ±rganÄ±n motivasyonlarÄ±nÄ± ve yÃ¶ntemlerini erkenden anlamamÄ±zÄ± saÄŸladÄ±. Ä°tibarÄ±mÄ±z gÃ¼Ã§lendi ve sektÃ¶rde Ã¶rnek teÅŸkil ettik.</p>`;
                    } else if (badgeInfo.text === 'KRÄ°ZÄ° YÃ–NETTÄ°') { 
                        debriefHTML += `<p><strong>Zorlu Bir MÃ¼cadele:</strong> Krizi yÃ¶netmekte baÅŸarÄ±lÄ± oldunuz ancak bazÄ± kararlarÄ±n uzun vadeli etkileri oldu. Ã–ÄŸrenilen derslerle gelecekteki gÃ¼venlik duruÅŸumuzu daha da saÄŸlamlaÅŸtÄ±rmalÄ±yÄ±z. CTI faaliyetleri kritik bilgiler saÄŸladÄ± ancak bazÄ± noktalarda daha hÄ±zlÄ± aksiyon alabilirdik.</p>`;
                    } else { 
                        debriefHTML += `<p><strong>Ciddi SonuÃ§lar:</strong> Kriz yÃ¶netimi sÃ¼recinde alÄ±nan bazÄ± kararlar, ÅŸirketin finansal zararlarÄ±nÄ± artÄ±rdÄ± ve itibarÄ±nÄ± ciddi ÅŸekilde zedeledi. Veri sÄ±zÄ±ntÄ±sÄ± ve sistem kesintileri, mÃ¼ÅŸteri gÃ¼venini sarstÄ±. Bu deneyimden acilen ders Ã§Ä±kararak gÃ¼venlik stratejilerimizi kÃ¶kten deÄŸiÅŸtirmeliyiz.</p>`;
                    }
                    debriefContent.innerHTML = debriefHTML;
                    
                    this.saveLeaderboard(totalScore);
                },

                updateState() { this.updateStatusBar(); this.updateSlackChat(this.state.currentSectionId); },

                updateSlackChat(currentSection) {
                    const sectionElement = document.getElementById(currentSection);
                    if (!sectionElement) return;
                    const chatViewer = sectionElement.querySelector('.slack-chat');
                    if (!chatViewer) return; 

                    let chat = '';
                    if (currentSection === 'day2_morning' || currentSection === 'day2_afternoon_investigation') {
                        chat = `
                            <div class="message"><span class="sender ceo">CEO Elara YÄ±lmaz:</span> Durumu yakÄ±ndan takip ediyorum. Hisselerimiz dÃ¼ÅŸÃ¼ÅŸe geÃ§ti, hÄ±zlÄ± bir Ã§Ã¶zÃ¼m bekliyorum!</div>
                            <div class="message"><span class="sender legal">Hukuk MÃ¼ÅŸaviri Zeynep Kaya:</span> Yasal sorumluluklarÄ±mÄ±zÄ± dikkatle deÄŸerlendirmeliyiz. Aceleci aÃ§Ä±klamalar, ileride sorun yaratabilir.</div>
                            <div class="message"><span class="sender ops">Operasyon DirektÃ¶rÃ¼ Levent AkÄ±n:</span> MÃ¼ÅŸterilerimizden yoÄŸun ÅŸikayetler alÄ±yoruz. Sistemler ne zaman normale dÃ¶necek? Ä°ÅŸ sÃ¼rekliliÄŸimiz tehlikede!</div>
                            <div class="message"><span class="sender cso">CSO Can Demir:</span> Ekiplerimiz 7/24 Ã§alÄ±ÅŸÄ±yor. CTI'dan gelen bilgiler, doÄŸru adÄ±mlarÄ± atmamÄ±z iÃ§in hayati Ã¶nem taÅŸÄ±yor.</div>
                            <div class="message"><span class="sender">Siz (CTI UzmanÄ±):</span> Mevcut verileri hÄ±zla analiz ediyoruz. Kara Tayfun'un TTP'lerini anlamak, karÅŸÄ± Ã¶nlemler iÃ§in kritik.</div>
                        `;
                    } else if (currentSection === 'day3_morning_communication' || currentSection === 'day3_afternoon_strategy') { 
                        chat = `
                            <div class="message"><span class="sender ceo">CEO Elara YÄ±lmaz:</span> Ä°lk ÅŸoku atlattÄ±k. Åžimdi geleceÄŸe yÃ¶nelik planlarÄ±mÄ±z ne olacak? Bu krizden nasÄ±l ders Ã§Ä±karacaÄŸÄ±z?</div>
                            <div class="message"><span class="sender ops">Operasyon DirektÃ¶rÃ¼ Levent AkÄ±n:</span> MÃ¼ÅŸteri gÃ¼venini yeniden kazanmak iÃ§in somut adÄ±mlara ihtiyacÄ±mÄ±z var. Kesintilerin telafisi Ã¶nemli.</div>
                            <div class="message"><span class="sender legal">Hukuk MÃ¼ÅŸaviri Zeynep Kaya:</span> YaÅŸanan olay, sÃ¶zleÅŸmelerimizdeki gÃ¼venlik maddelerinin gÃ¶zden geÃ§irilmesi gerektiÄŸini gÃ¶sterdi.</div>
                            <div class="message"><span class="sender cso">CSO Can Demir:</span> Savunma mekanizmalarÄ±mÄ±zÄ± daha da gÃ¼Ã§lendirmeliyiz. CTI ekibinin rolÃ¼ bu sÃ¼reÃ§te anahtar olacak.</div>
                            <div class="message"><span class="sender">Siz (CTI UzmanÄ±):</span> KÃ¶k neden analizi, gelecekteki saldÄ±rÄ±larÄ± Ã¶nlemek iÃ§in bize Ä±ÅŸÄ±k tutuyor. TopladÄ±ÄŸÄ±mÄ±z istihbarat Ã§ok deÄŸerli.</div>
                        `;
                    }
                    chatViewer.innerHTML = chat;
                },
                updateDynamicContent(sectionId) {},
                
                loadGameHTML() {
                    const gameHTMLContent = `
                        <div id="day1_morning" class="section">
                            <h2><i class="fa-solid fa-hourglass-start"></i> GÃ¼n 1: Ä°lk Sinyaller ve FÄ±sÄ±ltÄ±lar</h2>
                            <h3>Sabah 08:30 - Kahve ve KÃ¶tÃ¼ Bir His</h3>
                            <p>Sabah rutinini yaparken, Ã¶zel CTI kanallarÄ±ndan birinde ani bir hareketlilik fark ettiniz. Genellikle sÄ±zÄ±ntÄ± istihbaratÄ± paylaÅŸan bir dark web forumunda, Ã‡OLHAK'Ä±n kritik tedarikÃ§ilerinden <strong>Smart Teknoloji</strong> ile ilgili ÅŸifreli bir gÃ¶nderi belirdi. Smart Teknoloji, Ã‡olhak'a <strong>temel yazÄ±lÄ±m altyapÄ±sÄ±</strong> saÄŸlÄ±yor.</p>
                            <p>GÃ¶nderi, Temel yazÄ±lÄ±m altyapÄ±sÄ±nÄ±n "gizli bir kapÄ±ya" sahip olabileceÄŸine dair belirsiz ama endiÅŸe verici imalar iÃ§eriyor. HenÃ¼z bir kanÄ±t yok, sadece bir fÄ±sÄ±ltÄ±.</p>
                            <img src="images/darkweb_forum.png" alt="Dark Web forumunda ÅŸifreli gÃ¶nderi" class="scenario-image">
                            <div class="interactive-element">
                                <h4>CTI UzmanÄ± olarak ilk adÄ±mÄ±n ne olacak?</h4>
                                <div class="decision-buttons">
                                    <button class="btn" data-decision="g1-s-bilgilendir-ust-yonetim" data-next-section="day1_afternoon"><i class="fa-solid fa-share-nodes"></i><div class="btn-text">SeÃ§enek A: Hemen CEO Elara YÄ±lmaz ve CSO Can Demir'i Bilgilendir.<small>Durumu anÄ±nda en Ã¼st yÃ¶netime raporlayarak proaktif bir yaklaÅŸÄ±m sergile.</small></div></button>
                                    <button class="btn" data-decision="g1-s-istihbarat-dogrula" data-next-section="day1_afternoon"><i class="fa-solid fa-magnifying-glass"></i><div class="btn-text">SeÃ§enek B: Ã–nce Kendi Ä°stihbaratÄ±nÄ± DoÄŸrula ve GÃ¼venilir Kaynaklardan Ek Bilgi Topla.<small>Dark web gÃ¶nderisinin gÃ¼venilirliÄŸini teyit etmek iÃ§in daha fazla araÅŸtÄ±rma yap.</small></div></button>
                                </div>
                            </div>
                            <div class="learning-note"><strong>Ã–ÄŸrenme Notu:</strong> Siber krizin ilk anlarÄ± kritik Ã¶neme sahiptir. Ä°lk tepkiniz, krizin seyrini bÃ¼yÃ¼k Ã¶lÃ§Ã¼de etkileyebilir. Bilgi paylaÅŸÄ±mÄ± ve doÄŸrulama arasÄ±nda denge kurmak Ã¶nemlidir.</div>
                        </div>

                        <div id="day1_afternoon" class="section">
                            <h2><i class="fa-solid fa-bell"></i> GÃ¼n 1: Ã–ÄŸleden Sonra - Onaylanmayan ÅžÃ¼pheler</h2>
                            <h3>Ã–ÄŸleden Sonra 15:00 - SektÃ¶r AlarmÄ±</h3>
                            <p>SektÃ¶r lideri bir siber gÃ¼venlik araÅŸtÄ±rma firmasÄ± olan "Tehdit Analiz LaboratuvarÄ±" (TAL), "Kara Tayfun" grubunun tedarik zinciri saldÄ±rÄ±larÄ±nda yeni bir vektÃ¶r kullandÄ±ÄŸÄ±na dair bir uyarÄ± yayÄ±nladÄ±. UyarÄ±da, spesifik olarak yazÄ±lÄ±m imzalama sÃ¼reÃ§lerine sÄ±zÄ±ldÄ±ÄŸÄ± ve meÅŸru yazÄ±lÄ±mlara gizlice kÃ¶tÃ¼ amaÃ§lÄ± kod eklendiÄŸi belirtiliyor. HenÃ¼z Ã‡OLHAK veya Smart Teknoloji'den bahsedilmiyor, ancak temel yazÄ±lÄ±m altyapÄ±sÄ±nÄ±n yapÄ±sÄ±na dair teknik detaylarla ÅŸaÅŸÄ±rtÄ±cÄ± benzerlikler var.</p>
                            <img src="images/sector_alert.png" alt="SektÃ¶r uyarÄ± ekran gÃ¶rÃ¼ntÃ¼sÃ¼" class="scenario-image">
                            <div class="interactive-element">
                                <h4>CTI UzmanÄ± olarak hangi adÄ±mÄ± atacaksÄ±n?</h4>
                                <div class="decision-buttons">
                                    <button class="btn" data-decision="g1-o-teknik-tarama" data-next-section="day2_morning"><i class="fa-solid fa-bug-slash"></i><div class="btn-text">SeÃ§enek A: CSO Can Demir'in Ekibine DetaylÄ± IOC/TTP Listesi SaÄŸla ve Acil Teknik Tarama Talep Et.<small>OlasÄ± zafiyetleri hÄ±zla tespit etmek iÃ§in teknik ekibi yÃ¶nlendir.</small></div></button>
                                    <button class="btn" data-decision="g1-o-tedarikci-iletisim" data-next-section="day2_morning"><i class="fa-solid fa-handshake"></i><div class="btn-text">SeÃ§enek B: TedarikÃ§i Ä°liÅŸkileri YÃ¶neticisi Dr. Aylin GÃ¼neÅŸ AracÄ±lÄ±ÄŸÄ±yla Smart Teknoloji ile Derhal Ä°letiÅŸime GeÃ§.<small>Ortak soruÅŸturma baÅŸlatmak iÃ§in tedarikÃ§iyle temasa geÃ§.</small></div></button>
                                    <button class="btn" data-decision="g1-o-hukuki-degerlendirme" data-next-section="day2_morning"><i class="fa-solid fa-gavel"></i><div class="btn-text">SeÃ§enek C: Hukuk MÃ¼ÅŸaviri Zeynep Kaya'dan Yasal DeÄŸerlendirme Talep Et ve Kriz Ä°letiÅŸim PlanÄ±nÄ± HazÄ±rla.<small>Potansiyel yasal yÃ¼kÃ¼mlÃ¼lÃ¼kleri ve kamuoyu aÃ§Ä±klamasÄ±nÄ± deÄŸerlendir.</small></div></button>
                                </div>
                            </div>
                            <div class="learning-note"><strong>Ã–ÄŸrenme Notu:</strong> Kriz anlarÄ±nda doÄŸru Ã¶nceliklendirme, kaynaklarÄ±n verimli kullanÄ±lmasÄ± iÃ§in hayati Ã¶neme sahiptir. Teknik mÃ¼dahale, iÅŸ birliÄŸi ve yasal hazÄ±rlÄ±k arasÄ±ndaki dengeyi iyi kurmalÄ±sÄ±n.</div>
                        </div>

                        <div id="day2_morning" class="section">
                            <h2><i class="fa-solid fa-burst"></i> GÃ¼n 2: Krizin Patlak Vermesi</h2>
                            <h3>Sabah 09:30 - Felaket Senaryosu GerÃ§ekleÅŸiyor!</h3>
                            <p>BirkaÃ§ kritik Ã‡OLHAK mÃ¼ÅŸterisi (bÃ¼yÃ¼k bir finans kurumu ve bir enerji daÄŸÄ±tÄ±m ÅŸebekesi), temel yazÄ±lÄ±m altyapÄ±sÄ±nÄ±n son gÃ¼ncellemesi sonrasÄ±nda kimlik doÄŸrulama sistemlerinde anormal davranÄ±ÅŸlar rapor etmeye baÅŸladÄ±. KullanÄ±cÄ± hesaplarÄ±nda rastgele kilitlenmeler, yetkisiz eriÅŸim denemeleri ve beklenmedik log hareketleri tespit ediliyor.</p>
                            <p>CSO Can Demir'den panik iÃ§inde bir Ã§aÄŸrÄ± aldÄ±nÄ±z: <em>"Smart Teknoloji'nin temel yazÄ±lÄ±m altyapÄ±sÄ±ndan gelen telemetri verilerinde, daha Ã¶nce bahsettiÄŸin yazÄ±lÄ±m imzalama anormallikleriyle eÅŸleÅŸen imzalar bulduk. SanÄ±rÄ±m <strong>Kara Tayfun iÃ§eride!</strong>"</em></p>
                            <img src="images/crisis_desk.png" alt="Acil durum kriz masasÄ±" class="scenario-image">
                            <div class="interactive-element">
                                <h4>Kriz ekibine acil olarak hangi CTI temelli Ã¶neride bulunursun?</h4>
                                <div class="slack-chat" id="slackChat"></div>
                                <div class="decision-buttons">
                                    <button class="btn" data-decision="g2-s-tersine-muhendislik" data-next-section="day2_afternoon_investigation"><i class="fa-solid fa-code-branch"></i><div class="btn-text">SeÃ§enek A: KÃ¶tÃ¼ AmaÃ§lÄ± YazÄ±lÄ±mÄ±n Yeteneklerini AnÄ±nda Tersine MÃ¼hendislik Ekibine Sevk Et.<small>SaldÄ±rÄ±nÄ±n kapsamÄ±nÄ± ve potansiyel etkilerini tam olarak anlamak iÃ§in detaylÄ± analiz yap.</small></div></button>
                                    <button class="btn" data-decision="g2-s-modul-yalÄ±tma" data-next-section="day2_afternoon_investigation"><i class="fa-solid fa-unlink"></i><div class="btn-text">SeÃ§enek B: Etkilenen TÃ¼m MÃ¼ÅŸterilerin Temel YazÄ±lÄ±m AltyapÄ±sÄ±nÄ± Acilen Devre DÄ±ÅŸÄ± BÄ±rakmayÄ± veya YalÄ±tmayÄ± Ã–ner.<small>SaldÄ±rÄ±nÄ±n yayÄ±lmasÄ±nÄ± durdurmak iÃ§in radikal ve hÄ±zlÄ± bir mÃ¼dahale yap.</small></div></button>
                                    <button class="btn" data-decision="g2-s-motivasyon-analizi" data-next-section="day2_afternoon_investigation"><i class="fa-solid fa-chart-network"></i><div class="btn-text">SeÃ§enek C: Kara Tayfun Grubunun MotivasyonlarÄ±nÄ± ve Hedeflerini Analiz Et ve Kriz Ekibine Ä°stihbarat Brifingi Ver.<small>SaldÄ±rÄ±nÄ±n arkasÄ±ndaki niyeti ve uzun vadeli hedefleri ortaya koy.</small></div></button>
                                </div>
                            </div>
                            <div class="learning-note"><strong>Ã–ÄŸrenme Notu:</strong> Bir saldÄ±rÄ± kesinleÅŸtiÄŸinde, hÄ±z ve doÄŸru mÃ¼dahale kritik Ã¶neme sahiptir. KararlarÄ±nÄ±n hem teknik hem de operasyonel sonuÃ§larÄ± olacaktÄ±r.</div>
                        </div>

                        <div id="day2_afternoon_investigation" class="section">
                            <h2><i class="fa-solid fa-magnifying-glass-chart"></i> GÃ¼n 2: Ã–ÄŸleden Sonra - Derinlemesine SoruÅŸturma ve KÃ¶k Neden Analizi</h2>
                            <h3>Ã–ÄŸleden Sonra 14:00 - Kara Kutuya BakÄ±ÅŸ</h3>
                            <p>Kara Tayfun'un Smart Teknoloji yazÄ±lÄ±mÄ±na nasÄ±l sÄ±zdÄ±ÄŸÄ±na dair ilk bulgular ortaya Ã§Ä±kmaya baÅŸladÄ±. Ä°lk tersine mÃ¼hendislik analizleri, kÃ¶tÃ¼ amaÃ§lÄ± kodun sadece bir arka kapÄ± olmadÄ±ÄŸÄ±nÄ±, aynÄ± zamanda belirli bir tedarik zinciri bileÅŸenini hedef aldÄ±ÄŸÄ±nÄ± gÃ¶steriyor: <strong>SynapseTech'in aÃ§Ä±k kaynaklÄ± kÃ¼tÃ¼phanelerinden biri.</strong> Bu kÃ¼tÃ¼phane, Smart Teknoloji'nin temel yazÄ±lÄ±m altyapÄ±sÄ±nÄ±n bir parÃ§asÄ±.</p>
                            <p>AyrÄ±ca, dark web'deki istihbarat kanallarÄ±nÄ±zda "SynapseTech" ve "tedarik zinciri zafiyeti" anahtar kelimeleriyle ilgili yeni, ÅŸifreli mesajlar dolaÅŸmaya baÅŸladÄ±. Bu mesajlar, baÅŸka siber suÃ§ gruplarÄ±nÄ±n da bu zafiyeti kendi Ã§Ä±karlarÄ± iÃ§in kullanmaya Ã§alÄ±ÅŸtÄ±ÄŸÄ±na iÅŸaret ediyor olabilir.</p>
                            <img src="images/synapse_tech_analysis.png" alt="SynapseTech analiz gÃ¶rseli" class="scenario-image">
                            <div class="interactive-element">
                                <h4>CTI UzmanÄ± olarak bir sonraki kritik adÄ±mÄ±n ne olacak?</h4>
                                <div class="decision-buttons">
                                    <button class="btn" data-decision="g2-o-synapsetech-arastirma" data-next-section="day3_morning_communication"><i class="fa-solid fa-search"></i><div class="btn-text">SeÃ§enek A: SynapseTech KÃ¼tÃ¼phanesindeki Zafiyeti Derinlemesine AraÅŸtÄ±r ve KÃ¶tÃ¼ye KullanÄ±m BiÃ§imlerini Belgele.<small>Bu, saldÄ±rganÄ±n tam giriÅŸ vektÃ¶rÃ¼nÃ¼ anlamanÄ± ve benzer saldÄ±rÄ±larÄ± Ã¶nlemeni saÄŸlayacak.</small></div></button>
                                    <button class="btn" data-decision="g2-o-sucu-resmi-makamlara-bildir" data-next-section="day3_morning_communication"><i class="fa-solid fa-building-columns"></i><div class="btn-text">SeÃ§enek B: Ulusal Siber GÃ¼venlik Birimlerine (CERT/CSIRT) ve Kolluk Kuvvetlerine Resmi Bildirimde Bulun.<small>SaldÄ±rÄ±nÄ±n ulusal gÃ¼venliÄŸi etkileyebileceÄŸini vurgulayarak yasal sÃ¼reci ve resmi soruÅŸturmayÄ± baÅŸlat.</small></div></button>
                                    <button class="btn" data-decision="g2-o-daha-fazla-istihbarat" data-next-section="day3_morning_communication"><i class="fa-solid fa-eye"></i><div class="btn-text">SeÃ§enek C: Kara Tayfun ile Ä°lgili Daha Fazla Tehdit Ä°stihbaratÄ± Topla.<small>SaldÄ±rÄ±nÄ±n diÄŸer tedarik zinciri bileÅŸenlerine yayÄ±lma potansiyelini veya diÄŸer hedefleri anlamaya odaklan.</small></div></button>
                                </div>
                            </div>
                            <div class="learning-note"><strong>Ã–ÄŸrenme Notu:</strong> KÃ¶k neden analizi, gelecekteki saldÄ±rÄ±larÄ± Ã¶nlemek iÃ§in kritik Ã¶neme sahiptir. AynÄ± zamanda, yasal ve halkla iliÅŸkiler boyutunda atÄ±lacak adÄ±mlar, krizin genel algÄ±sÄ±nÄ± etkiler.</div>
                        </div>

                        <div id="day3_morning_communication" class="section">
                            <h2><i class="fa-solid fa-bullhorn"></i> GÃ¼n 3: Sabah - Hasar Kontrol ve Ä°letiÅŸim</h2>
                            <h3>Sabah 09:30 - SÄ±kÄ±ÅŸan Zaman</h3>
                            <p>Temel yazÄ±lÄ±m altyapÄ±sÄ±ndaki arka kapÄ± ve SynapseTech zafiyeti nedeniyle, Kara Tayfun'un mÃ¼ÅŸterilerinizin aÄŸlarÄ±na derinlemesine sÄ±zdÄ±ÄŸÄ± ve veri sÄ±zÄ±ntÄ±larÄ± yaÅŸandÄ±ÄŸÄ± kesinleÅŸti. Medyada haberler Ã§Ä±ÄŸ gibi bÃ¼yÃ¼yor: <strong>"Ã‡OLHAK Teknoloji ve TedarikÃ§isi ArasÄ±ndaki Kriz DerinleÅŸiyor!"</strong> Kamuoyu ÅŸirketinizden net bir aÃ§Ä±klama bekliyor.</p>
                            <img src="images/press_conference.png" alt="BasÄ±n toplantÄ±sÄ± gÃ¶rseli" class="scenario-image">
                            <div class="interactive-element">
                                <h4>Halka ve paydaÅŸlara nasÄ±l bir aÃ§Ä±klama yapacaksÄ±n?</h4>
                                <div class="decision-buttons">
                                    <button class="btn" data-decision="g3-s-tam-seffaflÄ±k" data-next-section="day3_afternoon_strategy"><i class="fa-solid fa-check-double"></i><div class="btn-text">SeÃ§enek A: Tam ÅžeffaflÄ±k.<small>OlayÄ± tÃ¼m detaylarÄ±yla, sÄ±zÄ±ntÄ±nÄ±n nedenini, Kara Tayfun grubunu ve tedarik zinciri zafiyetini aÃ§Ä±klayÄ±n.</small></div></button>
                                    <button class="btn" data-decision="g3-s-sÄ±nÄ±rlÄ±-acÄ±klama" data-next-section="day3_afternoon_strategy"><i class="fa-solid fa-file-contract"></i><div class="btn-text">SeÃ§enek B: SÄ±nÄ±rlÄ± AÃ§Ä±klama.<small>Sadece 'teknik bir problem' olduÄŸunu belirtin, detaylardan kaÃ§Ä±nÄ±n ve soruÅŸturmanÄ±n devam ettiÄŸini sÃ¶yleyin.</small></div></button>
                                    <button class="btn" data-decision="g3-s-sucu-disari-atma" data-next-section="day3_afternoon_strategy"><i class="fa-solid fa-mask"></i><div class="btn-text">SeÃ§enek C: SuÃ§u DÄ±ÅŸarÄ±ya Atma.<small>SaldÄ±rÄ±nÄ±n tamamen tedarikÃ§i Smart Teknoloji'nin sorumluluÄŸunda olduÄŸunu ve Ã‡OLHAK'Ä±n maÄŸdur olduÄŸunu iddia edin.</small></div></button>
                                </div>
                            </div>
                            <div class="learning-note"><strong>Ã–ÄŸrenme Notu:</strong> Kriz iletiÅŸimi, itibar yÃ¶netiminin bel kemiÄŸidir. ÅžeffaflÄ±k, gÃ¼ven, sorumluluk ve yasal yÃ¼kÃ¼mlÃ¼lÃ¼kler arasÄ±nda hassas bir denge kurmalÄ±sÄ±n.</div>
                        </div>

                        <div id="day3_afternoon_strategy" class="section">
                            <h2><i class="fa-solid fa-shield-alt"></i> GÃ¼n 3: Ã–ÄŸleden Sonra - Uzun Vadeli Strateji ve Ä°yileÅŸme</h2>
                            <h3>Ã–ÄŸleden Sonra 14:00 - YaralarÄ± Sarma ZamanÄ±</h3>
                            <p>SaldÄ±rÄ±nÄ±n nedenleri ve kapsamÄ± artÄ±k bÃ¼yÃ¼k Ã¶lÃ§Ã¼de netleÅŸti. Åžirketinizin gelecekteki siber dayanÄ±klÄ±lÄ±ÄŸÄ± iÃ§in Ã¶nemli kararlar almanÄ±z gerekiyor. CEO Elara YÄ±lmaz ve CSO Can Demir, ÅŸirket iÃ§i gÃ¼venlik protokollerinin ve tedarikÃ§i denetimlerinin acilen gÃ¶zden geÃ§irilmesi gerektiÄŸini belirtiyor. Hukuk MÃ¼ÅŸaviri Zeynep Kaya ise potansiyel davalara karÅŸÄ± yasal savunma stratejileri Ã¼zerinde Ã§alÄ±ÅŸÄ±yor. Finansal kayÄ±plar artmaya devam ediyor.</p>
                            <img src="images/recovery_efforts.png" alt="Kurtarma ve iyileÅŸme Ã§abalarÄ± gÃ¶rseli" class="scenario-image">
                            <div class="interactive-element">
                                <h4>Åžirketinizin gelecekteki siber dayanÄ±klÄ±lÄ±ÄŸÄ± iÃ§in hangi uzun vadeli stratejiyi Ã¶nerirsin?</h4>
                                <div class="decision-buttons">
                                    <button class="btn" data-decision="g3-o-kapsamlÄ±-guvenlik-programÄ±" data-next-section="finalSection"><i class="fa-solid fa-lock"></i><div class="btn-text">SeÃ§enek A: KapsamlÄ± Tedarik Zinciri GÃ¼venliÄŸi ProgramÄ± BaÅŸlat.<small>TÃ¼m tedarikÃ§iler iÃ§in zorunlu denetimler, SBOM (Software Bill of Materials) ve SCA (Software Composition Analysis) entegrasyonu talep et. CTI kaynaklarÄ±nÄ± artÄ±r.</small></div></button>
                                    <button class="btn" data-decision="g3-o-odaklÄ±-iyilestirme" data-next-section="finalSection"><i class="fa-solid fa-screwdriver-wrench"></i><div class="btn-text">SeÃ§enek B: Sadece Temel YazÄ±lÄ±m AltyapÄ±sÄ±ndaki Zafiyetleri Gider ve Acil Yama Uygula.<small>HÄ±zlÄ±ca en kritik sorunlarÄ± Ã§Ã¶z, ancak daha geniÅŸ tedarik zinciri gÃ¼venliÄŸi konularÄ±nÄ± ertele.</small></div></button>
                                    <button class="btn" data-decision="g3-o-degerlendirmeyi-geciktir" data-next-section="finalSection"><i class="fa-solid fa-clock-rotate-left"></i><div class="btn-text">SeÃ§enek C: Kriz SonrasÄ± KapsamlÄ± DeÄŸerlendirmeyi ve YatÄ±rÄ±mlarÄ± Geciktir.<small>BÃ¼tÃ§e kÄ±sÄ±tlamalarÄ± ve personel yorgunluÄŸunu gerekÃ§e gÃ¶stererek durumu stabilize etmeye odaklan ve uzun vadeli planlarÄ± ertele.</small></div></button>
                                </div>
                            </div>
                            <div class="learning-note"><strong>Ã–ÄŸrenme Notu:</strong> Bir krizin ardÄ±ndan alÄ±nan uzun vadeli kararlar, ÅŸirketin sadece kÄ±sa vadeli iyileÅŸmesini deÄŸil, aynÄ± zamanda gelecekteki dayanÄ±klÄ±lÄ±ÄŸÄ±nÄ± ve itibarÄ±nÄ± da belirler.</div>
                        </div>

                        <div id="finalSection" class="section centered-page" style="display: none;">
                            <h2><i class="fa-solid fa-chart-line"></i> Kriz SonrasÄ± DeÄŸerlendirme Raporu</h2>
                            <p>SimÃ¼lasyon tamamlandÄ±. Kriz yÃ¶netimi performansÄ±nÄ±zÄ±n detaylÄ± dÃ¶kÃ¼mÃ¼ aÅŸaÄŸÄ±dadÄ±r.</p>
                            <div id="performance-badge-container"><span id="performance-badge"></span></div>
                            <div class="final-metrics" id="finalMetricsContainer"></div>
                            <div class="post-crisis-layout">
                                <div class="event-timeline">
                                    <h3><i class="fa-solid fa-timeline"></i> Karar Zaman TÃ¼neli</h3>
                                    <ul id="decision-timeline-list"></ul>
                                </div>
                                <div class="strategic-debrief">
                                    <h3><i class="fa-solid fa-lightbulb"></i> Stratejik DeÄŸerlendirme</h3>
                                    <div id="strategic-debrief-content"></div>
                                    <h3 style="margin-top: 20px;"><i class="fa-solid fa-calculator"></i> Puan DÃ¶kÃ¼mÃ¼</h3>
                                    <ul id="score-breakdown"></ul>
                                </div>
                            </div>
                            <div class="decision-buttons" style="margin-top: 40px; display:flex; gap:12px; flex-wrap:wrap; justify-content:center;">
                                <button class="btn btn-start" onclick="location.reload()"><i class="fa-solid fa-arrow-rotate-right"></i> SimÃ¼lasyonu Yeniden BaÅŸlat</button>
                                <button class="btn" id="openLeaderboardBtn"><i class="fa-solid fa-trophy"></i> Liderlik Tablosu</button>
                            </div>
                        </div>
                    `;
                    this.elements.gameContent.innerHTML = gameHTMLContent;
                    this.elements.sections = this.elements.gameContent.querySelectorAll('.section');
                    this.elements.leaderboard.btnOpen = document.getElementById('openLeaderboardBtn');
                    this.elements.leaderboard.btnOpen?.addEventListener('click', () => this.openLeaderboard());
                    hljs.highlightAll();
                },
                
                startGlobalTimer() {
                    if (this.timer.running) return;
                    this.timer.running = true;
                    this.timer.remaining = this.timer.total;
                    this.updateTimerUI();
                    this.timer.intervalId = setInterval(() => {
                        this.timer.remaining--;
                        this.updateTimerUI();
                        if (this.timer.remaining <= 0) {
                            this.stopGlobalTimer();
                            alert("SÃ¼re doldu! Rapor oluÅŸturuluyor.");
                            this.showFinalReport();
                        }
                    }, 1000);
                },

                stopGlobalTimer() {
                    if (this.timer.intervalId) clearInterval(this.timer.intervalId);
                    this.timer.intervalId = null;
                    this.timer.running = false;
                },

                updateTimerUI() {
                    const m = String(Math.floor(this.timer.remaining / 60)).padStart(2,'0');
                    const s = String(this.timer.remaining % 60).padStart(2,'0');
                    if (this.elements.statusBar.timer) {
                        this.elements.statusBar.timer.textContent = `${m}:${s}`;
                    }
                },

                openLeaderboard() {
                    this.elements.leaderboard.overlay.style.display = 'flex';
                    this.loadLeaderboard();
                },

                closeLeaderboard() {
                    this.elements.leaderboard.overlay.style.display = 'none';
                },

                async saveLeaderboard(finalScore) {
                    let name = localStorage.getItem('playerName');
                    if (!name || name.trim() === '') {
                        name = prompt("Liderlik tablosu iÃ§in isminizi girin:", "Anonim");
                        if (!name || name.trim() === '') name = 'Anonim';
                        localStorage.setItem('playerName', name);
                    }
                    
                    const payload = {
                        scenario: 'v4-supplychain',
                        name: name.toString().slice(0, 40),
                        score: finalScore,
                        details: this.score,
                        timeSpentSec: this.timer.total - this.timer.remaining,
                        timestamp: new Date().toISOString()
                    };

                    try {
                        const res = await fetch('/api/score', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        if (!res.ok) throw new Error('API request failed');
                    } catch(e) {
                        console.warn("API'ye ulaÅŸÄ±lamadÄ±. Puan yerel olarak saklanÄ±yor.");
                        const key = 'leaderboard-v4-supplychain';
                        const arr = JSON.parse(localStorage.getItem(key) || '[]');
                        arr.push(payload);
                        arr.sort((a,b)=> b.score - a.score);
                        localStorage.setItem(key, JSON.stringify(arr.slice(0,100)));
                    }
                },

                async loadLeaderboard() {
                    const tbody = this.elements.leaderboard.body;
                    const key = 'leaderboard-v4-supplychain';
                    tbody.innerHTML = `<tr><td colspan="4">YÃ¼kleniyorâ€¦</td></tr>`;
                    let rows = [];
                    try {
                        const res = await fetch('/api/leaderboard?scenario=v4-supplychain');
                        if (!res.ok) throw new Error('API request failed');
                        const data = await res.json();
                        rows = Array.isArray(data) ? data : [];
                    } catch(e) {
                        console.warn("API'ye ulaÅŸÄ±lamadÄ±. Liderlik tablosu yerelden yÃ¼kleniyor.");
                        const arr = JSON.parse(localStorage.getItem(key) || '[]');
                        rows = arr.map(x => ({ name: x.name, score: x.score, timestamp: x.timestamp }));
                    }

                    if (!rows.length) {
                        tbody.innerHTML = `<tr><td colspan="4">HenÃ¼z kayÄ±t bulunmuyor.</td></tr>`;
                        return;
                    }
                    
                    rows.sort((a,b)=> b.score - a.score);
                    tbody.innerHTML = rows.slice(0,50).map((r,i)=>`
                        <tr>
                            <td>${i+1}</td>
                            <td>${(r.name || 'Anonim').toString().slice(0,40)}</td>
                            <td>${r.score}</td>
                            <td>${r.timestamp ? new Date(r.timestamp).toLocaleString('tr-TR') : '-'}</td>
                        </tr>
                    `).join('');
                }
            };
            window.game.setup();
        });
    </script>
</body>
</html>
